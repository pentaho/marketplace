<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Pentaho Marketplace</title>
    <script type="text/javascript" src="webcontext.js?content=marketplace"></script>
    <script type="text/javascript" src="../../common-ui/resources/web/repo/pentaho-ajax.js"></script>
    
    <!-- Resources -->
    
    

    <!-- Blueprint CSS -->
    <link rel="stylesheet" href="lib/blueprint/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="lib/blueprint/print.css" type="text/css" media="print">
    <!--[if lt IE 8]><link rel="stylesheet" href="lib/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->

    

    
    <script type="text/javascript" src="lib/modernizr.js"></script>
    <script type="text/javascript" src="lib/jquery.js"></script>
    <script type="text/javascript" src="lib/jquery.hotkeys.js"></script>
    <script type="text/javascript" src="lib/jquery.iframe-auto-height.js"></script>
    <script type="text/javascript" src="lib/caf-TRUNK.SNAPSHOT.js"></script>
    
    <link rel="stylesheet" href="lib/borderBox.css" type="text/css"/>
    <link href="lib/caf-TRUNK.SNAPSHOT.css" type="text/css" rel="stylesheet"/>
    
    
    <link href="marketplace.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="marketplace.js"></script>
    
  </head>
  <body>
      
      <div id="marketplace">
          
      </div>
      
      
      <!--
      
	<div id="marketplacePanel" class="marketplacePanel">
          <div class="marketplaceHeader">
                                        <div class="marketplaceTitle">Marketplace</div>
                                    </div>   
          
       
            <div class="groupTitle" id='available'>Available Plugins</div>
            
            <div class="groupTitle" id='installed'>Installed Plugins</div>
			<table style="margin: 10px;">
			<tr>
				<td>
				<div class="marketplaceMessagex">
						<h3>Pentaho Marketplace</h3>
						Discover and install new functionality available in the Pentaho BI Server through the Pentaho Marketplace.
						<br>
						<ul>
							<li>Learn more about the Stories and Ideas for the Marketplace <a href="http://wiki.pentaho.com/display/PMOPEN/Pentaho+BI+Server+Marketplace+Plugin">Here</a>.</li>
							<li>TODO: Guarantee no other files other than system/PLUGIN_ID are written to (No .. in id name) [needs tested]</li>
							<li>TODO: Include bi server release number for plugin request</li>
							<li>TODO: Store xml doc in session cache, provide a refresh button [v1?]</li>
							<li>TODO: Cleanse all strings from the server, avoiding html/js injection</li>
							<li>TODO: Figure out why some images aren't showing up, relative path, couldn't tell why it works <a href="http://localhost:8080/pentaho/content/common-ui/resources/web/test/style-samples.html"> here </a> but not in this html page.</li>
							<li>TODO: Use pretty dialogs for messages, show progress dialog?</li>
							<li style="text-decoration: line-through;">DONE: Determine the version number of installed plugins. [started]</li>
							<li style="text-decoration: line-through;">DONE: Finish styling, default HTML rendering</li>
							<li style="text-decoration: line-through;">DONE: Create webservice providing input to page</li>
							<li style="text-decoration: line-through;">DONE: Update page to call webservice on load, or show error message if permissions</li>
							<li style="text-decoration: line-through;">DONE: Have webservice call a remote XML file on the wiki?</li>
							<li style="text-decoration: line-through;">DONE: Create Kettle Job for downloading, unzipping, and installing</li>
							<li style="text-decoration: line-through;">DONE: Create Kettle Job for uninstalling</li>
							<li style="text-decoration: line-through;">DONE: Determine which plugins are already installed, display in installed section</li>

							</ul>
						<br>
						<br>
						<br>
					</div> 
                          
				</td>
			</tr>
			<tr>
				<td>

                       <table cellspacing="0" cellpadding="0" class="pentaho-disclosure-panel pentaho-disclosure-panel-open">
                            <tbody>
                                <tr>
                                    <td align="left" style="vertical-align: top;" class="header" onclick="toggleDisclosurePanel('disclosure-panel','disclosure-panel-icon')">
                                        <table>
                                            <tbody>
                                                <tr>
                                                    <td align="center" style="width: 16px;">
                                                        <img src="../../common-ui/web/test/images/spacer.gif" id="disclosure-panel-icon" class="pentaho-disclosure-panel-openicon"/>
                                                    </td>
                                                    <td><span style="font-size:14px;">Available Plugins</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="left" style="vertical-align: top;">
                                        <div id="disclosure-panel" class="pentaho-disclosure-panel-dropdown pentaho-shadow-padding">
                                            <div class="pentaho-rounded-panel-bottom-lr panel-content pentaho-shadow pentaho-padding-sm">
                                               <table style="width: 100%;" class="pentaho-table" id="availablePlugins">
			                            <tbody>
                        			        <tr>
			                                    <td class="pentaho-table-header-cell">
                        			                <div class="label">&nbsp;</div>
			                                    </td>
                        			        </tr>
			                                <tr>
                        			            <td class="pentaho-table-cell" id="availableFirstRow">No Available Plugins</td>
			                                </tr>
			                            </tbody>
			                        </table>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>


                       <table cellspacing="0" cellpadding="0" class="pentaho-disclosure-panel pentaho-disclosure-panel-open">
                            <tbody>
                                <tr>
                                    <td align="left" style="vertical-align: top;" class="header" onclick="toggleDisclosurePanel('disclosure-panel-2','disclosure-panel-icon-2')">
                                        <table>
                                            <tbody>
                                                <tr>
                                                    <td align="center" style="width: 16px;">
                                                        <img src="../../common-ui/web/test/images/spacer.gif" id="disclosure-panel-icon-2" class="pentaho-disclosure-panel-openicon"/>
                                                    </td>
                                                    <td><span style="font-size:14px;">Installed Plugins</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="left" style="vertical-align: top;">
                                        <div id="disclosure-panel-2" class="pentaho-disclosure-panel-dropdown pentaho-shadow-padding">
                                            <div class="pentaho-rounded-panel-bottom-lr panel-content pentaho-shadow pentaho-padding-sm">

                        <table style="width: 100%;" class="pentaho-table" id="installedPlugins">
                            <tbody>
                                <tr>
                                    <td class="pentaho-table-header-cell">
                                        <div class="label">&nbsp;</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="pentaho-table-cell" id="installedFirstRow">
					No Installed Plugins.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                                            </div>
                                        </div>
                                    </td>
					
                                </tr>
                            </tbody>
                        </table>



                        <script type="text/javascript">
                        
                            function toggleDisclosurePanel(panelId, iconId) {
                                if( document.getElementById(iconId).className == 'pentaho-disclosure-panel-openicon' ) {
                                    document.getElementById(panelId).style.display = 'none';
                                    document.getElementById(iconId).className = 'pentaho-disclosure-panel-closeicon';
                                } else {
                                    document.getElementById(panelId).style.display = 'block';
                                    document.getElementById(iconId).className = 'pentaho-disclosure-panel-openicon';
                                }
                                return false;
                            }
                        
                        </script>


				</td>
			</tr>
		</table>
	</div> -->
  </body>
  <script>
      
    /*
    $(document).ready(function(){
        
        
        
        
        
		var plugins = eval( '(' + pentahoMarketplace.getPlugins() + ')');
		if (!plugins || plugins.class == 'org.pentaho.marketplace.StatusMessage') {
			// wipe out entire page
			document.getElementById('marketplacePanel').innerHTML='Access Denied';
			return;
		} 
	
		for (var i = 0; i < plugins.length; i++) {
                    var html = renderPlugin(plugins[i]);
                    var divName = 'available';
                    if (plugins[i].installed) {
                        divName = 'installed';
                    }
                    var cell = document.createElement('div');
                    var parentDiv = document.getElementById(divName);
                    parentDiv.parentNode.insertBefore(cell,parentDiv.nextSibling);
                    cell.innerHTML=html;
		}
                
       
    });



    function renderAlternativeVersions(plugin) {
        if (!plugin.alternativeVersions)
            return "";
        var html = "";
        for (var i=0; i < plugin.alternativeVersions.length; i++) {
            var version = plugin.alternativeVersions[i];
            
            html += "<br/><a href=\"javascript:installNow('" + plugin.id + "', '" + version.id + "')\" style=\"font-size:20px;text-decoration: none;\">" + version.name+ "</a>";
        }
        return html;
    }
    
    function renderPlugin(plugin) {
            var html = "<div class='pluginDiv'>";
            //Plugin image
            html += "<div class='pluginImage'>" + 
                    "<img src=\"" + plugin.img + "\" width=\"50\" height=\"50\" style=\"width:45px;height:45px\">" +
                    "</div>";
            //Plugin title
            html += "<div class='pluginTitle'>" + plugin.name;
            if (!plugin.installed)
                html += "&nbsp;" + plugin.availableVersion;
           else {
               html += "&nbsp;" + plugin.installedVersion;
           }
            html += "</div>";
            
         //Plugin actions
            html += "<div class='pluginActions'>"
            if (!plugin.installed) {
                html += "<a href=\"javascript:installNow('" + plugin.id + "')\" style=\"font-size:20px;text-decoration: none;\">Install Now</a>" + renderAlternativeVersions(plugin);
            } else {
                if (plugin.installedVersion == plugin.availableVersion) {
                    html += "";
                } else {
                    html += "<a href=\"javascript:installNow('" + plugin.id + "')\" style=\"font-size:20px;text-decoration: none;\">Upgrade to</a><br>" + plugin.availableVersion;
                }
		html += "<a href=\"javascript:uninstall('" + plugin.id + "')\" style=\"font-size:20px;text-decoration: none;\">Uninstall</a>" + renderAlternativeVersions(plugin);
                
            }            
            html+= "</div>";
                        
            
            //Plugin description
            html += "<div class='pluginDescription'>"
            html += plugin.description;
            html += " <a href=\"" + plugin.learnMoreUrl + "\">Learn More...</a>";
            html += "</div>";
            
            //Plugin changelog
            if (plugin.changelog && plugin.changelog != "") {
                html += "<div class='pluginDescription'>"
                html += plugin.changelog;
                html += "</div>";
            }
            
            //Plugin compay
            html += "<div class='pluginDescription'>"
            html += "by <a href=\"" + plugin.companyUrl + "\">" + plugin.company + "</a>"
            html += "</div>";            
            
   
            
            html += '</div>';
            return html;        
    }
    
    function installNow(pluginId, versionId) {
    	// first show an alert box to confirm the user wants to install this plugin
    	alert('Are you sure you want to install this plugin?');
    	var response = eval ('(' + pentahoMarketplace.installNow(pluginId, versionId) + ')');
    	alert(response.message);
    }
    
    function uninstall(pluginId) {
    	alert('Are you sure you want to uninstall this plugin?');
    	try {
    		var response = eval ('(' + pentahoMarketplace.uninstall(pluginId) + ')');
    	   	alert(response.message);
    	} catch (e) {
    		alert(e);
    	}
    }
*/
  </script>
</html>
